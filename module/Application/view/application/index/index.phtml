<div class="jumbotron mt-5">
    <h1>Welcome to <span class="zf-green">Dzen Code Guestbook!</span></h1>
    <p>
        Great! We successfully completed the task.
        Now you can validate it.
    </p>
    <p><a class="btn btn-success btn-lg" href="https://github.com/sumtsow/dzen" target="_blank">Fork Dzen Code Guestbook on GitHub &raquo;</a></p>
</div>
<div class="row">
    <div class="col">
    <?php outRecusively($comments); ?>
    </div>
</div>
<p>
    <a class="btn btn-success my-3" href="<?php /*echo $this->url('comment', ['action' => 'add'])*/ ?>">Add new comment &raquo;</a>
</p>

<?php
    function outRecusively($comments) {
    foreach($comments as $comment) :
?>
        <div class="panel panel-default mx-3">
            <div class="panel-heading">
                <h3 class="panel-title"><span class="font-weight-bold"><?= $comment->user_name; ?></span> <?= (strftime("%d.%m.%Y Ð² %H:%m ", strtotime($comment->created_at))); ?></h3>
            </div>
            <div class="panel-body">
                <p><?= $comment->text; ?></p>
                <p><button type="button" class="btn btn-success float-right" data-toggle="modal" data-target="#comment" data-whatever="<?= $comment->id; ?>">Answer &raquo;</button></p>
            </div>
<?php
        if ($comment->children) :
            outRecusively($comment->children);
?>
        </div>
<?php
        endif;
    endforeach;
}
$form->prepare(); 
?>

<div class="modal fade" id="comment" tabindex="-1" role="dialog" aria-labelledby="comment" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="comment"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <?= $this->form()->openTag($form); ?>  
      <div class="modal-body">
        <?= $this->formHidden($form->get('csrf')); ?>  
        <?= $this->formHidden($form->get('parent')->setAttribute('id', 'parent')); ?>  
          <div class="form-group">
            <?= $this->formRow($form->get('user_name')->setAttributes(['class' => 'form-control', 'id' => 'user_name'])); ?>
          </div>
          
          <div class="form-group">
            <?= $this->formRow($form->get('email')->setAttributes(['class' => 'form-control', 'id' => 'email'])); ?>
          </div>

          <div class="form-group">
            <?= $this->formRow($form->get('home_page')->setAttributes(['class' => 'form-control', 'id' => 'home_page'])); ?>
          </div>
          
          <div class="form-group">
            <?= $this->formRow($form->get('text')->setAttributes(['class' => 'form-control', 'id' => 'text'])); ?>
          </div>
      </div>
      <div class="modal-footer">
        <?= $this->formSubmit($form->get('submit')->setAttribute('class', 'btn btn-success')); ?>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>
      <?= $this->form()->closeTag(); ?> 
    </div>
  </div>
</div>

<?= $this->inlineScript()
->prependFile($this->basePath('js/modal.js'))
?>
